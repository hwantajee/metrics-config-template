version: v0.1
data_source:
  name: bots_dim
  description: For each transformer bot, additional information about the bot.
  owners:
    - transformer@transformdata.io
  sql_query: |
    SELECT
      n AS id_bot
      , REGEXP_REPLACE(UUID(), '[^a-zA-Z]', '') AS bot_name
      , CAST(ROUND(RANDOM(), 0) AS INT) AS is_evil
      , DATE_ADD('day', MOD(n, 20), CAST('2020-10-01' AS DATE)) AS ds
    FROM (SELECT ROW_NUMBER() OVER () AS n FROM information_schema.columns LIMIT 50) AS n

  identifiers:
    - name: bot
      type: primary
      expr: id_bot

  measures:
    - name: bots
      description: The total number of transformer bots.
      expr: "1"
      agg: sum

  dimensions:
    - name: ds
      type: time
    - name: bot_name
      type: categorical
    - name: good_or_evil
      type: categorical
      expr: CASE WHEN is_evil = 1 THEN 'evil' ELSE 'good' END

  mutability:
    type: ds_append_only
