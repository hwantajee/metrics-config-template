version: v0.1
data_source:
  name: customer_dim
  description: Location and description of all customers
  owners:
    - support@transformdata.io
  sql_query: |
    SELECT
      'c234567'             AS id_customer
      , 'MX'                AS country
      , '2020-01-01'        AS ds
    UNION ALL SELECT 'c546356', 'US', '2020-02-02'
    UNION ALL SELECT 'c344543', 'MX', '2020-02-02'
    UNION ALL SELECT 'c234325', 'US', '2020-02-02'
    UNION ALL SELECT 'c678768', 'US', '2020-02-02'

  identifiers:
    - name: customer
      type: primary
      expr: id_customer

  measures:
    - name: new_customers
      expr: "1"
      agg: sum

  dimensions:
    - name: ds
      type: time
      expr: DATE_TRUNC('day', created_at)
      type_params:
        is_primary: True
        time_format: YYYY-MM-DD
        time_granularity: day
    - name: country
      description: The country where the customer is located.
      type: categorical

  mutability:
    type: immutable
