version: v0.1
data_source:
  name: bots_dim
  description: For each transformer bot, additional information about the bot.
  owners:
    - transformer@transformdata.io
  sql_query: |
    SELECT
      n AS id_bot
      , TRANSLATE(CAST(CAST(n * 1234567 AS BIGINT) AS VARCHAR), '1234567890', 'abcdefghij') AS bot_name
      , CAST(ROUND(MOD(n, 2), 0) AS INT) AS is_evil
      , DATE((DATE('2020-10-01') + MOD(n, 20))) AS ds
    FROM (  SELECT ROW_NUMBER() OVER(ORDER BY SEQ4()) AS n
            FROM TABLE(GENERATOR(ROWCOUNT => 10))
         ) AS t

  identifiers:
    - name: bot
      type: primary
      expr: id_bot

  measures:
    - name: bots
      description: The total number of transformer bots.
      expr: "1"
      agg: sum

  dimensions:
    - name: ds
      type: time
    - name: bot_name
      type: categorical
    - name: good_or_evil
      type: categorical
      expr: CASE WHEN is_evil = 1 THEN 'evil' ELSE 'good' END

  mutability:
    type: ds_append_only
